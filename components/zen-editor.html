<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">

<polymer-element name="zen-editor">
  <template>
    <style>
      html {font-size: 1em;}
      body {
        background-color: white;
        font-family: 'Libre Baskerville', serif;
        font-weight: 400;
        line-height: 1.45;
        color: #333;
      }
      p {margin-bottom: 1.3em;}
      h1, h2, h3, h4 {
        margin: 1.414em 0 0.5em;
        font-weight: inherit;
        line-height: 1.2;
      }
      h1 {
        margin-top: 0;
        font-size: 2.441em;
      }
      h2 {font-size: 1.953em;}
      h3 {font-size: 1.563em;}
      h4 {font-size: 1.25em;}

      * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }

      .container {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;

        flex-direction: column;
        height: 100%;
        min-height: 100%;
      }

        header {
          flex: 1 0 auto;
          flex: none;
          padding: .25em;
          border-bottom: 1px solid rgb(231, 231, 231);
        }

        .editor-pane {
          display: flex;
          flex: 1;
        }

          .raw, #rendered {
            display: block;
            flex: 1 auto;
            -webkit-flex: 1 auto;
            flex: 100%;
            padding: .25em;
            font-family: Helvetica, sans-serif;
            font-size: 18px;
            font-weight: normal;
            overflow: scroll;
          }


          #rendered {
            font-family: 'HelveticaNeue-Light', 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif;
          }

          .zen-mode #rendered {
            flex: none;
            -webkit-flex: none;
            display: none;
            width: 0;
            overflow: hidden;
          }

          .raw {
            font-family: monospace;
            -webkit-appearance: none;
            outline: none;
            resize: none;
            border: none;
            word-wrap: normal;
          }

          paper-button {
            float: right;
          }
    </style>

    <div class="container">
      <header>
        <paper-button raised on-tap="{{toggleZenMode}}" tabindex="0">
          Z
        </paper-button>
      </header>
      <div class="editor-pane">
        <textarea autofocus class="raw" value="{{raw}}"></textarea>
        <div id="rendered"></div>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      ready: function(){
        this.$.rendered.innerHTML = renderMd(this.raw)
      },
      raw: restore('raw'),
      rawChanged: function(){
        this.$.rendered.innerHTML = renderMd(this.raw || '')
        localStorage.raw = this.raw
      },
      toggleZenMode: function(event, boh, element){
        console.log( arguments )
      }
    })

    function renderMd(raw){
      return marked(raw)
    }
    function restore(key){
      return localStorage[key] || ''
    }
  </script>
</polymer-element>
